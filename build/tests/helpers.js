// Generated by CoffeeScript 1.7.1
var Client, client, fixtures, helpers, initializeApplication;

fixtures = require('cozy-fixtures');

Client = require('request-json').JsonClient;

module.exports = helpers = {};

helpers.options = {};

helpers.app = null;

if (process.env.COVERAGE) {
  helpers.prefix = '../instrumented/';
} else if (process.env.USE_JS) {
  helpers.prefix = '../build/';
} else {
  helpers.prefix = '../';
}

helpers.options = {
  serverHost: process.env.HOST || 'localhost',
  serverPort: process.env.PORT || 9875
};

process.env.HOST = helpers.options.serverHost;

process.env.PORT = helpers.options.serverPort;

client = new Client("http://" + helpers.options.serverHost + ":" + helpers.options.serverPort + "/", {
  jar: true
});

helpers.getClient = function() {
  return client;
};

initializeApplication = require("" + helpers.prefix + "server");

helpers.startApp = function(done) {
  this.timeout(15000);
  return initializeApplication((function(_this) {
    return function(app, server) {
      _this.app = app;
      _this.app.server = server;
      return done();
    };
  })(this));
};

helpers.stopApp = function(done) {
  this.timeout(10000);
  return this.app.server.close(done);
};

helpers.cleanDB = function(done) {
  this.timeout(10000);
  return fixtures.resetDatabase({
    callback: done
  });
};

helpers.cleanDBWithRequests = function(done) {
  this.timeout(10000);
  return fixtures.resetDatabase({
    removeAllRequests: true,
    callback: done
  });
};
